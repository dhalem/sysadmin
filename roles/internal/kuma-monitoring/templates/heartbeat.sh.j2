#!/bin/bash
# Uptime Kuma heartbeat script for {{ monitor_name }}
# Generated by Ansible on {{ ansible_date_time.iso8601 }}

KUMA_URL="{{ kuma_url }}"
PUSH_TOKEN="{{ push_token }}"
HOSTNAME="{{ ansible_hostname }}"

# Send heartbeat to Kuma
curl -s -o /dev/null -w "%{http_code}" "${KUMA_URL}/api/push/${PUSH_TOKEN}" > /tmp/kuma-heartbeat.log 2>&1

# Log the result
if [ $? -eq 0 ]; then
    echo "$(date): Heartbeat sent successfully from ${HOSTNAME}" >> /var/log/kuma-heartbeat.log
else
    echo "$(date): Failed to send heartbeat from ${HOSTNAME}" >> /var/log/kuma-heartbeat.log
fi
